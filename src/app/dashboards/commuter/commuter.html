<!-- ==================== TOP BAR ==================== -->
<div class="top-bar">
  <div class="top-bar-left">
    <button class="toggle-tools-btn" (click)="toggleTools()" [class.active]="showTools">
      {{ showTools ? 'âœ• Close Tools' : 'â˜° Tools' }}
    </button>
  </div>

  <div class="top-bar-right">
    <!-- Chat button -->
    <button class="btn chat-btn" (click)="toggleChat()">ğŸ’¬ Chat</button>

    <!-- Account dropdown -->
    <div class="account-dropdown" [class.open]="accountDropdownOpen">
      <button class="btn account-btn" (click)="toggleAccountDropdown()">
        ğŸ‘¤ {{ userName || 'Guest' }} â–¼
      </button>
      <ul class="dropdown-menu">
        <li>
          <button class="btn small w-100" (click)="openSettings(); toggleAccountDropdown()">âš™ï¸ Settings</button>
        </li>
        <li>
          <button class="btn small w-100 logout" (click)="logout(); toggleAccountDropdown()">ğŸšª Logout</button>
        </li>
      </ul>
    </div>
  </div>
</div>

<!-- ==================== MAIN CONTENT ==================== -->
<div class="main-content-wrapper">

  <!-- ==================== TOOLS SIDEBAR ==================== -->
  <div class="map-sidebar" [class.visible]="showTools">
    <div class="sidebar-header">
      <strong>Interactive Map Tool</strong>
      <button class="btn small" (click)="locateMe()">ğŸ“ My location</button>
    </div>

    <div class="control-row">
      <label for="radiusRange">Radius (m)</label>
      <input id="radiusRange" type="range" min="50" max="5000" step="10"
            [(ngModel)]="radius" (input)="updateRadiusFromUI()" />
    </div>

    <div class="control-row">
      <input id="radiusNumber" type="number" min="50" max="5000" step="10"
            [(ngModel)]="radius" (change)="updateRadiusFromUI()" style="flex:1; padding:6px;" />
      <button class="btn" (click)="fitToCircle()">Fit</button>
    </div>

    <div class="coords">
      <div>Radius: <span>{{ radius }}</span> m</div>
    </div>

    <p class="small">Drag the marker to move the circle.</p>
  </div>

  <!-- ==================== MAP ==================== -->
  <div class="main-content">
    <div class="map-wrapper">
      <div id="map" class="map"></div>
    </div>
  </div>
</div>

  <div class="nearest-jeepney" *ngIf="nearestJeep">
    <h4>Nearest Jeepney</h4>
    <div><strong>Plate:</strong> {{ nearestJeep.plate }}</div>
    <div><strong>Distance:</strong> {{ nearestDistanceMeters }} m</div>
    <div><strong>ETA:</strong> {{ nearestEtaMinutes }} min</div>
  </div>

<!-- ==================== RIGHT-SIDE DASHBOARD (Chat) ==================== -->
<div class="right-dashboard" [class.show]="showChatDashboard">

  <div class="community">
    <h4>Community</h4>
    <div class="community-input">
      <textarea [(ngModel)]="newPostText" placeholder="Share an updateâ€¦" class="form-control"></textarea>
      <button class="post-btn w-100 mt-2" (click)="sendPost()">Post</button>
    </div>
    <ul class="mt-3">
      <li *ngFor="let post of communityPosts">
        <strong>{{ post.user || 'Anonymous' }}</strong>: {{ post.text }}
        <span class="time">{{ post.timeDisplay }}</span>
      </li>
    </ul>
  </div>
</div>

<!-- ==================== SETTINGS MODAL ==================== -->
<div class="modal" *ngIf="showSettings">
  <div class="modal-content">
    <h3>Account Settings</h3>

    <label><strong>Username:</strong></label>
    <input type="text"
           [(ngModel)]="customUsername"
           class="form-control"
           placeholder="Enter username">

    <button class="btn mt-2" (click)="saveUsername()">Save</button>
    <button class="btn mt-3" (click)="closeSettings()">Close</button>
  </div>
</div>
