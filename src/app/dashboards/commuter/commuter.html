<div class="otw-commuter-shell">
  <!-- PHONE FRAME WITH MAP -->
  <div class="phone-frame">
    <!-- Phone image -->
<img src="assets/iphone-frame.png"
     alt="iPhone frame"
     class="phone-image" />



    <!-- Screen window positioned over the image -->
    <div class="phone-screen">
      <div class="map-frame">
        <div class="map-container">
          <div id="map" class="map"></div>

          <!-- FLOATING TOP NAV BAR -->
          <div class="gm-top-nav">
            <button class="gm-icon-btn" (click)="toggleTools()">‚ò∞</button>

            <div class="gm-search-pill">
              <span class="gm-search-icon">üîç</span>
              <input
                class="gm-search-input"
                type="text"
                placeholder="Search"
                [(ngModel)]="searchText"
                (keyup.enter)="runSearch()" />
            </div>

            <button class="gm-icon-btn" (click)="toggleChat()">üí¨</button>

            <button class="gm-avatar-btn" (click)="toggleAccountDropdown()">
              {{ (userName || 'G')[0] | uppercase }}
            </button>

            <div class="gm-account-menu" *ngIf="accountDropdownOpen">
              <button (click)="openSettings()">Settings</button>
              <button (click)="logout()">Logout</button>
            </div>
          </div>

          <!-- CATEGORY CHIPS UNDER NAV -->
          <div class="gm-chip-row">
            <button class="gm-chip">Jeepneys</button>
            <button class="gm-chip">Stops</button>
            <button class="gm-chip">Traffic</button>
          </div>

          <!-- RIGHT CONTROLS (e.g., locate me) -->
          <div class="gm-right-controls">
            <button class="gm-round-btn" (click)="locateMe()" title="My location">
              üìç
            </button>
          </div>

          <!-- BOTTOM INFO BAR (Top 3 nearest jeepneys) -->
          <div class="gm-bottom-bar" *ngIf="nearestJeepneys.length">
            <div class="gm-bottom-main">
              <div class="gm-bottom-title">Top 3 Nearest Jeepneys</div>

              <div class="gm-bottom-list">
                <div
                  class="gm-bottom-sub"
                  *ngFor="let j of nearestJeepneys; let i = index">
                  <strong>#{{ i + 1 }}</strong> ‚Äî
                  Plate {{ j.plate }} ‚Ä¢ {{ j.distance }} m ‚Ä¢ {{ j.eta }} min ‚Ä¢
                  Passengers: {{ j.passengerCount || 0 }} /
                  {{ j.capacity || 'N/A' }}
                </div>
              </div>
            </div>
          </div>
          <!-- END BOTTOM BAR -->
        </div>
      </div>
    </div>
  </div>

  <!-- TOOLS PANEL (SLIDE FROM LEFT) -->
  <aside class="map-sidebar" [class.visible]="showTools">
    <div class="sidebar-header">
      <strong>Interactive Map Tool</strong>
      <button class="btn small" (click)="locateMe()">üìç My location</button>
    </div>

    <div class="control-row">
      <label for="radiusRange">Radius (m)</label>
      <input
        id="radiusRange"
        type="range"
        min="50"
        max="5000"
        step="10"
        [(ngModel)]="radius"
        (input)="updateRadiusFromUI()" />
    </div>

    <div class="control-row">
      <input
        id="radiusNumber"
        type="number"
        min="50"
        max="5000"
        step="10"
        [(ngModel)]="radius"
        (change)="updateRadiusFromUI()"
        style="flex: 1; padding: 6px;" />
      <button class="btn" (click)="fitToCircle()">Fit</button>
    </div>

    <div class="coords">
      <div>Radius: <span>{{ radius }}</span> m</div>
    </div>

    <p class="small">Drag the marker to move the circle.</p>
  </aside>

  <!-- CHAT / COMMUNITY SLIDE-OVER (RIGHT) -->
  <aside class="right-dashboard" [class.show]="showChatDashboard">
    <div class="community">
      <h4>Community</h4>

      <div class="community-input">
        <textarea
          [(ngModel)]="newPostText"
          placeholder="Share an update‚Ä¶"
          class="form-control"></textarea>
        <button class="post-btn w-100 mt-2" (click)="sendPost()">Post</button>
      </div>

      <ul class="mt-3 community-list">
        <li *ngFor="let post of communityPosts">
          <strong>{{ post.user || 'Anonymous' }}</strong>: {{ post.text }}
          <span class="time">{{ post.timeDisplay }}</span>
        </li>
      </ul>

      <hr />

      <ul class="mt-3 chat-list">
        <li *ngFor="let msg of chatMessages">
          {{ msg }}
        </li>
      </ul>
    </div>
  </aside>

  <!-- SETTINGS MODAL -->
  <div class="modal" *ngIf="showSettings">
    <div class="modal-content">
      <h3>Account Settings</h3>

      <label><strong>Username:</strong></label>
      <input
        type="text"
        [(ngModel)]="customUsername"
        class="form-control"
        placeholder="Enter username" />

      <button class="btn mt-2" (click)="saveUsername()">Save</button>
      <button class="btn mt-3" (click)="closeSettings()">Close</button>
    </div>
  </div>
</div>
